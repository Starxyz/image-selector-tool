# 图片筛选批量处理工具 PRD

## 1. 产品概述

### 1.1 产品定位
一款专为质检人员设计的图片快速筛选和批量处理桌面工具，用于从OK图片文件夹中快速识别和分拣NG样品。

### 1.2 技术栈选择
**推荐技术栈：Tauri + React + TypeScript + Rust**

**选择理由：**
- Tauri：现代化跨平台桌面应用框架，性能优异，内存占用低
- React：组件化开发，状态管理清晰，丰富的生态系统
- TypeScript：类型安全，代码可维护性强
- Rust：后端逻辑处理，高性能文件系统操作，内存安全
- 图片处理：前端Canvas API + Rust图片处理库

**Tauri相比Electron的优势：**
- 性能：内存占用减少90%，启动速度提升3-5倍
- 安全：Rust后端天然内存安全，权限控制更严格
- 体积：打包体积仅15-20MB（vs Electron 100MB+）
- 原生集成：更好的系统API调用和文件操作性能

## 2. 功能需求

### 2.1 核心功能流程

```
选择文件夹 → 加载图片列表 → 图片浏览模式 → 标记筛选 → 批量处理
```

### 2.2 详细功能规格

#### 2.2.1 文件夹选择功能
**功能描述：** 用户选择包含图片的源文件夹

**具体要求：**
- 提供"选择文件夹"按钮，调用系统文件夹选择对话框
- 支持的图片格式：jpg, jpeg, png, bmp, gif, webp
- 自动递归扫描子文件夹（可选开关）
- 显示扫描进度条
- 完成后显示：总图片数量、文件夹路径

**异常处理：**
- 文件夹无图片时提示用户
- 文件夹无访问权限时给出错误提示

#### 2.2.2 图片浏览功能
**功能描述：** 全屏式图片查看器

**界面布局：**
```
┌─────────────────────────────────────────┐
│  [文件名.jpg]    [1/100]    [已标记: 5]  │  ← 顶部信息栏（半透明）
│                                         │
│                                         │
│              图片显示区域                 │
│           （自适应缩放，保持比例）          │
│                                         │
│                                         │
│  [◀ 上一张]  [空格:标记]  [下一张 ▶]    │  ← 底部控制栏（半透明）
└─────────────────────────────────────────┘
```

**显示要求：**
- 图片自适应窗口大小，保持原始宽高比
- 图片居中显示，背景为深色（#1a1a1a）
- 文件名显示在图片上方，半透明黑色背景，白色文字
- 支持图片缩放：鼠标滚轮放大缩小，双击重置

#### 2.2.3 导航和标记功能
**快捷键设计：**
- `←` / `A` : 上一张图片
- `→` / `D` : 下一张图片  
- `Space` : 标记/取消标记当前图片
- `Home` : 跳转到第一张
- `End` : 跳转到最后一张
- `Esc` : 退出浏览模式

**标记状态：**
- 未标记：正常显示
- 已标记：图片边框显示红色高亮，右上角显示红色标记图标
- 实时更新已标记数量

#### 2.2.4 批量处理功能
**触发时机：** 用户浏览完所有图片后，或点击"完成筛选"按钮

**处理选项：**
```
┌─────────────────────────────────────┐
│          筛选完成                    │
│                                     │
│  已标记 8 张图片进行处理              │
│                                     │
│  目标操作：                          │
│  ○ 复制到新文件夹                    │
│  ● 移动到新文件夹                    │
│                                     │
│  [选择目标文件夹]                    │
│                                     │
│  保持原文件夹结构： ☑               │
│                                     │
│     [取消]    [开始处理]            │
└─────────────────────────────────────┘
```

**处理逻辑：**
- 显示操作进度条
- 支持操作撤销（仅移动操作）
- 处理完成后显示结果报告

## 3. 界面设计要求

### 3.1 整体风格
- 深色主题，护眼设计
- 简洁现代的界面风格
- 响应式布局，支持不同分辨率

### 3.2 颜色规范
```css
主背景色: #1a1a1a
次背景色: #2d2d2d
文字颜色: #ffffff
强调色: #0078d4
警告色: #ff4444
成功色: #00aa00
```

## 4. 性能要求

### 4.1 响应性能
- 图片切换响应时间 < 100ms（Tauri原生性能优势）
- 支持大文件夹（2000+图片）流畅浏览
- 内存占用优化：预加载当前+前后各3张图片
- 应用启动时间 < 1秒
- 批量文件操作利用Rust并发特性，处理速度提升50%

### 4.2 兼容性
- Windows 10/11 系统（主要目标）
- macOS 10.15+ 系统（可选扩展）
- Linux 发行版（可选扩展）
- 最小分辨率：1280x720
- 支持高DPI显示器
- 内存占用目标：< 100MB（相比Electron节省60%+）

## 5. 开发优先级

### Phase 1（MVP版本 - Tauri基础架构）
1. Tauri项目初始化和配置
2. Rust后端文件扫描API开发
3. React前端基础界面搭建
4. 图片浏览器核心功能
5. 键盘导航和标记功能
6. 简单的批量复制功能

### Phase 2（功能完善 - 性能优化）
1. Rust并发文件操作优化
2. 图片预加载和缓存机制
3. 图片缩放功能
4. 批量移动功能
5. 操作撤销功能
6. 界面美化和流畅动画

### Phase 3（增强功能 - 跨平台扩展）
1. 子文件夹递归扫描
2. 多种图片格式支持（利用Rust image库）
3. 操作历史记录和恢复
4. 快捷键自定义
5. macOS和Linux平台适配
6. 应用自动更新机制

## 6. 技术实现要点

### 6.1 核心模块架构

**前端模块（React + TypeScript）：**
```typescript
// 前端状态管理
interface AppState {
  images: ImageFile[]
  currentIndex: number
  markedIndices: Set<number>
  isProcessing: boolean
  folderPath: string
}

// 前端图片管理模块
class ImageViewer {
  loadImage(path: string): Promise<HTMLImageElement>
  preloadImages(indices: number[]): void
  getCurrentImage(): ImageFile
  handleKeyboardNavigation(): void
}

// Tauri API调用封装
class TauriAPI {
  scanFolder(path: string): Promise<ImageFile[]>
  copyFiles(files: ImageFile[], targetPath: string): Promise<void>
  moveFiles(files: ImageFile[], targetPath: string): Promise<void>
  openFolderDialog(): Promise<string>
}
```

**后端模块（Rust）：**
```rust
// 文件管理模块
pub struct FileManager;
impl FileManager {
    pub async fn scan_folder(path: &str) -> Result<Vec<ImageFile>, String>
    pub async fn copy_files(files: &[ImageFile], target: &str) -> Result<(), String>
    pub async fn move_files(files: &[ImageFile], target: &str) -> Result<(), String>
    pub fn get_image_metadata(path: &str) -> Result<ImageMetadata, String>
}

// 图片处理模块
pub struct ImageProcessor;
impl ImageProcessor {
    pub fn get_image_info(path: &str) -> Result<ImageInfo, String>
    pub async fn batch_process(operations: Vec<FileOperation>) -> Result<(), String>
}
```

### 6.2 关键依赖

**前端依赖：**
```json
{
  "react": "^18.2.0",
  "typescript": "^5.0.0",
  "@tauri-apps/api": "^1.5.0",
  "zustand": "^4.4.0",
  "tailwindcss": "^3.3.0"
}
```

**后端依赖（Cargo.toml）：**
```toml
[dependencies]
tauri = { version = "1.5", features = ["api-all"] }
serde = { version = "1.0", features = ["derive"] }
tokio = { version = "1.0", features = ["full"] }
image = "0.24"
walkdir = "2.4"
rfd = "0.12"  # 文件对话框
```

## 7. 项目结构建议

```
image-selector/
├── src-tauri/              # Rust后端
│   ├── src/
│   │   ├── main.rs         # 主入口
│   │   ├── commands.rs     # Tauri命令定义
│   │   ├── file_manager.rs # 文件操作模块
│   │   ├── image_processor.rs # 图片处理模块
│   │   └── utils.rs        # 工具函数
│   ├── Cargo.toml          # Rust依赖配置
│   ├── tauri.conf.json     # Tauri配置
│   └── icons/              # 应用图标
├── src/                    # React前端
│   ├── components/
│   │   ├── FolderSelector.tsx
│   │   ├── ImageViewer.tsx
│   │   ├── BatchProcessor.tsx
│   │   └── KeyboardHandler.tsx
│   ├── hooks/
│   │   ├── useImageNavigation.ts
│   │   ├── useFileOperations.ts
│   │   └── useKeyboardShortcuts.ts
│   ├── stores/
│   │   └── appStore.ts     # Zustand状态管理
│   ├── utils/
│   │   ├── tauriApi.ts     # Tauri API封装
│   │   └── imageUtils.ts
│   ├── types/
│   │   └── index.ts        # TypeScript类型定义
│   ├── styles/
│   │   └── globals.css     # Tailwind样式
│   └── App.tsx
├── public/                 # 静态资源
├── dist/                   # 构建输出
├── package.json            # 前端依赖
└── README.md
```

## 8. 验收标准

### 8.1 功能验收
- [ ] 能够正确选择并扫描文件夹中的所有图片
- [ ] 图片浏览流畅，快捷键响应正常
- [ ] 标记功能正常，状态显示准确
- [ ] 批量操作成功率100%，支持大量文件处理

### 8.2 性能验收
- [ ] 2000张图片文件夹加载时间 < 3秒（Rust并发扫描）
- [ ] 图片切换延迟 < 100ms（原生性能优势）
- [ ] 内存占用控制在 < 100MB（相比Electron大幅优化）
- [ ] 应用启动时间 < 1秒
- [ ] 批量文件操作速度提升50%以上

### 8.3 用户体验验收
- [ ] 界面直观易用，学习成本低
- [ ] 操作流程顺畅，无明显卡顿
- [ ] 错误处理友好，提示信息清晰
- [ ] 应用启动速度快，响应迅速
- [ ] 系统资源占用合理，不影响其他应用

## 9. Tauri特有技术实现要点

### 9.1 前后端通信架构
```typescript
// 前端调用后端命令
import { invoke } from '@tauri-apps/api/tauri'

// 扫描文件夹
const images = await invoke<ImageFile[]>('scan_folder', { path: folderPath })

// 批量文件操作
await invoke('batch_copy_files', {
  files: selectedFiles,
  targetPath: destinationPath
})
```

```rust
// 后端命令定义
#[tauri::command]
async fn scan_folder(path: String) -> Result<Vec<ImageFile>, String> {
    FileManager::scan_folder(&path).await
}

#[tauri::command]
async fn batch_copy_files(files: Vec<ImageFile>, target_path: String) -> Result<(), String> {
    FileManager::copy_files(&files, &target_path).await
}
```

### 9.2 安全配置
```json
// tauri.conf.json 安全配置
{
  "tauri": {
    "allowlist": {
      "fs": {
        "all": false,
        "readFile": true,
        "writeFile": true,
        "readDir": true,
        "copyFile": true,
        "createDir": true
      },
      "dialog": {
        "all": false,
        "open": true,
        "save": true
      }
    }
  }
}
```

### 9.3 性能优化策略
- **并发文件扫描**：使用Rust的tokio异步运行时
- **内存管理**：Rust自动内存管理，避免内存泄漏
- **图片预加载**：前端智能预加载机制
- **批量操作优化**：Rust并发处理，充分利用多核CPU

### 9.4 打包和分发
```bash
# 开发环境
npm run tauri dev

# 生产构建
npm run tauri build

# 生成安装包（Windows）
# 输出：src-tauri/target/release/bundle/msi/
```